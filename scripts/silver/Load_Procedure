IF OBJECT_ID('silver.crm_cust_info','U') IS NOT NULL
	TRUNCATE TABLE silver.crm_cust_info;

INSERT INTO silver.crm_cust_info(
cst_id,
cst_key,
cst_firstname,
cst_lastname,
cst_marital_status,
cst_gndr,
cst_create_date)

	select 
	c.cst_id,
	c.cst_key,
	TRIM(c.cst_firstname) cst_firstname,
	TRIM(c.cst_lastname) cst_lastname,
	CASE 
		WHEN UPPER(TRIM(cst_marital_status))='M' THEN 'Married'
		WHEN UPPER(TRIM(cst_marital_status))='S' THEN 'Single'
		ELSE 'n/a'
	END as cst_martial_status,

	CASE 
		WHEN UPPER(TRIM(cst_gndr))='M' THEN 'Male'
		WHEN UPPER(TRIM(cst_gndr))='F' THEN 'Female'
		ELSE 'n/a'
	END cst_gndr,
	c.cst_create_date
	from(
		--No Duplicates or Nulls in Primary key
		select* from
			(
			select *,
			ROW_NUMBER() over(partition by cst_id order by cst_create_date desc) flag_last
			from bronze.crm_cust_info
			where cst_id is not null)t
		where flag_last=1
		)c

---------------------------------------------------------------



